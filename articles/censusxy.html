<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the censusxy Package • censusxy</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the censusxy Package">
<meta property="og:description" content="censusxy">
<meta property="og:image" content="https://slu-openGIS.github.io/censusxy/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">censusxy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/censusxy.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/slu-openGIS/censusxy/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the censusxy Package</h1>
                        <h4 data-toc-skip class="author">Branson Fox and Christopher Prener, Ph.D.</h4>
            
            <h4 data-toc-skip class="date">2022-05-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/slu-openGIS/censusxy/blob/HEAD/vignettes/censusxy.Rmd" class="external-link"><code>vignettes/censusxy.Rmd</code></a></small>
      <div class="hidden name"><code>censusxy.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>censusxy</code> package is designed to provide easy access to the <a href="https://geocoding.geo.census.gov/geocoder/" class="external-link">U.S. Census Bureau Geocoding Tools</a> in <code>R</code>.</p>
<div class="section level3">
<h3 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h3>
<p>There do not exist many packages for free or reproducible geocoding in the <code>R</code> environment. However, the Census Bureau Geocoding Tools allow for both unlimited free geocoding as well as an added level of reproducibility compared to commercial geocoders. Many geospatial workflows involve a large quantity of addresses, hence our core focus is on batch geocoding.</p>
</div>
<div class="section level3">
<h3 id="responsible-use">Responsible Use<a class="anchor" aria-label="anchor" href="#responsible-use"></a>
</h3>
<p>The U.S. Census Bureau makes their geocoding API available without any API key, and this package allows for virtually unlimited batch geocoding. Please use this package responsibly, as others will need use of this API for their research.</p>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
</div>
<div class="section level3">
<h3 id="installing-censusxy">Installing censusxy<a class="anchor" aria-label="anchor" href="#installing-censusxy"></a>
</h3>
<p>The easiest way to get <code>censusxy</code> is to install it from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"censusxy"</span><span class="op">)</span></code></pre></div>
<p>Alternatively, the development version of <code>censusxy</code> can be accessed from GitHub with <code>remotes</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"slu-openGIS/censusxy"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="installing-suggested-dependencies">Installing Suggested Dependencies<a class="anchor" aria-label="anchor" href="#installing-suggested-dependencies"></a>
</h3>
<p>Since the package does not need <code>sf</code> for its basic functionality, it is a suggested dependency rather than a required one. However, many users will want to map these data as <code>sf</code> objects, and we therefore recommend users install <code>sf</code>. Windows and macOS users should be able to install <code>sf</code> without significant issues unless they are building from source. Linux users will need to install several open source spatial libraries to get <code>sf</code> itself up and running.</p>
<p>The other suggested dependencies that users may want to consider installing have to do with parallel processing. As with <code>sf</code>, it is not necessary for users to take advantage of this functionality to use <code>censusxy</code>. If you do want make requests to the Census Bureau’s API in parallel, you will need <code>doParallel</code> as well as <code>foreach</code>.</p>
<p>If you want to use these packages, you can either install them individually (faster) or install all of the suggested dependencies at once (slower, will also give you a number of other packages you may or may not want):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## install sf and/or parallel packages</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"sf"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"doParallel"</span>,<span class="st">"foreach"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## install all suggested dependencies</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"censusxy"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="geocoding-considerations">Geocoding Considerations<a class="anchor" aria-label="anchor" href="#geocoding-considerations"></a>
</h2>
<div class="section level3">
<h3 id="censusxy-performance">censusxy Performance<a class="anchor" aria-label="anchor" href="#censusxy-performance"></a>
</h3>
<div class="section level4">
<h4 id="server-availability">Server Availability<a class="anchor" aria-label="anchor" href="#server-availability"></a>
</h4>
<p>One of the biggest drawbacks of the Census Bureau’s geocoders is their availability and speed. Users of <code>censusxy</code> have reported issues to us where <code>censusxy</code> appears not to work on their computers. Generally speaking, the issues are with servers on the Census Bureau’s end. If you notice that the package does not seem to be working, take a break for a few hours and try again. You will hopefully find that your code, with no changes, executes correctly and returns geocoded data. If you notice continued issues, please do not hesitate to <a href="https://github.com/slu-openGIS/censusxy/issues/new/choose" class="external-link">open an issue for us to investigate</a>.</p>
</div>
<div class="section level4">
<h4 id="processing-speed">Processing Speed<a class="anchor" aria-label="anchor" href="#processing-speed"></a>
</h4>
<p>Another performance issue with <code>censusxy</code> relates to speed. The issue, generally speaking, is not within the package itself but rather with external factors. These include your computer’s processing power, the quality of your internet connection, and - most importantly - the speed that the Census Bureau’s servers process your request. We have taken two steps to improve <code>censusxy</code>’s performance over using the Census Bureau’s geocoding web interface. The first is that we extract unique addresses in your data and only send those for geocoding. Thus, a large geocoding job may shrink considerably if it contains repetitive addresses.</p>
<p>The second step we take is to break your data into “chunks” if you have more than 1,000 records. This is below the maximum number of rows that the Census Bureau accepts for geocoding. <code>censusxy</code> sends these as separate geocoding requests before putting your data back together when geocoding is completed. One of the biggest things you can do to improve the performance of <code>censusxy</code> is to utilize our <em>optional</em> parallel processing features, which may require the installation of extra packages (see the Installation section above and the description of parallel processing below). When parallel processing is used, these chunks of data can be sent out simultaneously for geocoding.</p>
</div>
<div class="section level4">
<h4 id="data-quality">Data Quality<a class="anchor" aria-label="anchor" href="#data-quality"></a>
</h4>
<p>A third performance issue with <code>censusxy</code> relates to the quality of input data. Street addresses that are not formatted according to USPS standards may cause an entire “chunk” of data to be returned without being geocoded. If you notice many <code>NA</code> values for location, check a few with the single line geocoder:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">censusxy</span><span class="fu">::</span><span class="fu"><a href="../reference/cxy_single.html">cxy_single</a></span><span class="op">(</span><span class="st">"3700 Lindell Blvd"</span>, <span class="st">"St. Louis"</span>, <span class="st">"MO"</span>, <span class="fl">63139</span><span class="op">)</span></code></pre></div>
<p>If you get invalid data back, or an error like <code>The server, while working as a gateway to get a response needed to handle the request, got an invalid response</code>, there is something wrong with your specific address. One thing to watch for are non-ASCII characters, such as <code>Lindèll</code> in the example below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">censusxy</span><span class="fu">::</span><span class="fu"><a href="../reference/cxy_single.html">cxy_single</a></span><span class="op">(</span><span class="st">"3700 Lindèll Blvd"</span>, <span class="st">"St. Louis"</span>, <span class="st">"MO"</span>, <span class="fl">63139</span><span class="op">)</span></code></pre></div>
<p>This will return the error described above or an <code>NA</code> for <code>cxy_status</code> if you are using <code><a href="../reference/cxy_geocode.html">cxy_geocode()</a></code>.</p>
<p>If you get valid data back from the API with <code><a href="../reference/cxy_single.html">cxy_single()</a></code>, it is more than likely that another address in the same “chunk” has a formatting problem that is causing errors. Pre-processing your data to eliminate problematic addresses (such as those that contain point of interest information or non-ASCII characters) can help eliminate this problem.</p>
<p>Another strategy is to break up your data into smaller chunks prior to sending it to be geocoded. Then, geocode these chunks individually to try and isolate the problematic addresses. For example, we can use the following <code>base</code> functions to create chunks of <span class="math inline">\(n = 200\)</span> observations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">batches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">stl_homicides</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">stl_homicides</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">200</span> <span class="op">)</span></code></pre></div>
<p>These could then be passed individually to <code><a href="../reference/cxy_geocode.html">cxy_geocode()</a></code> using <code>batches[[1]]</code> and so on.</p>
</div>
</div>
<div class="section level3">
<h3 id="picking-a-suitable-api">Picking a Suitable API<a class="anchor" aria-label="anchor" href="#picking-a-suitable-api"></a>
</h3>
<p>The Census Geocoder contains 4 primary functions, 3 for single address geocoding, and 1 for batch geocoding. For interactive use cases, a Shiny application for example, the single line geocoder is recommended. For large quantities of addresses, the batch endpoint is favorable. If your use case is locating coordinates within census geometries, only a single coordinate function is available for this task.</p>
</div>
<div class="section level3">
<h3 id="picking-a-return-type">Picking a Return Type<a class="anchor" aria-label="anchor" href="#picking-a-return-type"></a>
</h3>
<p>If you are interested in census geometries (composed of FIPS codes for state, county, tract and block), you should specify ‘geographies’ in the <code>return</code> argument. This also necessitates the use of a vintage.</p>
</div>
<div class="section level3">
<h3 id="consider-the-benchmark-and-vintage">Consider the Benchmark and Vintage<a class="anchor" aria-label="anchor" href="#consider-the-benchmark-and-vintage"></a>
</h3>
<p>Vintage is only important to consider if you would like Census geographies to accompany your coordinate data. It has no impact on geocoding coordinates (location). You can obtain a data frame of valid benchmarks and vintages with their respective functions. For vintages, you must supply the name or ID of the benchmark you have chosen.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># return benchmarks</span>
<span class="fu"><a href="../reference/cxy_benchmarks.html">cxy_benchmarks</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># return vintages</span>
<span class="fu"><a href="../reference/cxy_vintages.html">cxy_vintages</a></span><span class="op">(</span>benchmark <span class="op">=</span> <span class="st">'Public_AR_Current'</span><span class="op">)</span></code></pre></div>
<p>If you would like to return data including Census geographies, set <code>return</code> to <code>"geographies"</code>.</p>
<p>Setting a specific benchmark can also be used to reproduce geocoding results. Changes to the data the Census Bureau supplies for geocoding may mean that the specific coordinates returned for a given address are modified. Using the latest benchmark may mean that addresses geocoded earlier are returned at a different coordinate. Using benchmarks allows you replicate earlier geocodes.</p>
<p>If you are not concerned about Census geographies or being able to reproduce the exact coordinates for each supplied, the functions will default to the latest benchmark.</p>
</div>
<div class="section level3">
<h3 id="parallelization">Parallelization<a class="anchor" aria-label="anchor" href="#parallelization"></a>
</h3>
<p>This is an <em>optional</em> set of tools to take advantage of multiple threads if your computer has a multi-core processor. The <code>parallel</code> argument can be used to specify the number of cores you would like to dedicate to geocoding tasks. Once you execute the function, your batch geocoding request will be automatically distributed across your cores to return results faster. The function will not allow you to specify more cores than are available, and will instead default to the maximum number of available cores.</p>
<p>Since this is <em>optional</em>, there are additional dependencies that are not automatically installed. See the installation instructions above for details on ensuring your <code>R</code> environment is ready for parallel processing.</p>
<p>Users on macOS should note that there have been <a href="https://github.com/slu-openGIS/censusxy/issues/42" class="external-link">issues reported</a> with using the <code>parallel</code> argument on macOS v12.4. Users with this specific operating system version <em>may</em> experience the following error if <code>parallel</code> is greater than <code>1</code>:</p>
<pre><code>The process has forked and you cannot use this CoreFoundation functionality safely. You MUST exec().
The process has forked and you cannot use this CoreFoundation functionality safely. You MUST exec().
Break on __THE_PROCESS_HAS_FORKED_AND_YOU_CANNOT_USE_THIS_COREFOUNDATION_FUNCTIONALITY___YOU_MUST_EXEC__() to debug.
Break on __THE_PROCESS_HAS_FORKED_AND_YOU_CANNOT_USE_THIS_COREFOUNDATION_FUNCTIONALITY___YOU_MUST_EXEC__() to debug.
Error in parallel::mclapply(batches, batch_geocoder, return, timeout,  : 
  The operating system returned a parallel processing error - see censusxy's website for more information.</code></pre>
<p>We will update the package documentation again if this issue persists beyond macOS v12.4 and/or the next release of <code>R</code> (which includes the <code>parallel</code> package). In our testing, we have noticed that this behavior occurs inconsistency, and we have been able to successfully execute our code after restarting our <code>R</code> session.</p>
</div>
<div class="section level3">
<h3 id="selection-a-class-and-output">Selection a Class and Output<a class="anchor" aria-label="anchor" href="#selection-a-class-and-output"></a>
</h3>
<p>There are two options for <code>class</code>, which governs the type of object <code>censusxy</code> returns. By default, a <code>"dataframe"</code> is returned. However, users may <em>optionally</em> set <code>class</code> to <code>"sf"</code>, which will return the results as an <code>sf</code> object. Doing so allows for an immediate preview of your data on a map and for these data to be exported in a geospatial format, like <code>.geojson</code> or <code>.shp</code>. However, returning an <code>sf</code> object will mean that <code>censusxy</code> can only return addresses successfully matched by the geocoder. A helpful message denoting how many rows were removed will print in the console.</p>
<p>Since returning an <code>sf</code> object is <em>optional</em>, there are additional dependencies that are not automatically installed. See the installation instructions above for details on ensuring your <code>R</code> environment is ready for parallel processing.</p>
<p>You may also specify <code>output</code> as <code>"simple"</code> or <code>"full"</code>. Simple returns only coordinates (and a GEOID if <code>return = "geographies"</code>) and this is suitable for most use cases. If you desire all of the raw output from the geocoder, please specify full instead.</p>
</div>
<div class="section level3">
<h3 id="setting-a-timeout-parameter">Setting a Timeout Parameter<a class="anchor" aria-label="anchor" href="#setting-a-timeout-parameter"></a>
</h3>
<p>The function contains an argument for timeout, which specifies how many minutes until the API query ends as an error. In this implementation, it is per 1000 addresses, not the whole batch size. It is set to default at 30 minutes, which should be appropriate for most internet speeds.</p>
<p>If a batch times out, the function will terminate, and you will lose any geocoding progress.</p>
<p>Be cautious that batches taking a long time may allow your computer to sleep, which may cause a batch to never return. macOS users may find the app <a href="https://apps.apple.com/us/app/amphetamine/id937984704?mt=12" class="external-link">amphetamine</a> useful.</p>
</div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="importing-data">Importing Data<a class="anchor" aria-label="anchor" href="#importing-data"></a>
</h3>
<p>If you plan on using the single address geocoding tools, your data do not need to be in any specific class. To use the batch geocoder, your data must be in a data.frame (or equivalent class). This package provides data on homicides in St Louis City between 2008-2018 as example data in two forms - a small table with 24 addresses (<code>stl_homicides_small</code>) and a larger table with more records (<code>stl_homicides</code>)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slu-openGIS/censusxy" class="external-link">censusxy</a></span><span class="op">)</span>

<span class="co"># load sample data</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">stl_homicides_small</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parsing-addresses">Parsing Addresses<a class="anchor" aria-label="anchor" href="#parsing-addresses"></a>
</h3>
<p>For use of the batch API, your address data needs to be structured. Meaning, your data contains separate columns for street address, city, state and zip-code. You may find the <a href="https://github.com/slu-openGIS/postmastr" class="external-link"><code>postmastr</code></a> package useful for this task. Only street address is mandatory, but omission of city, state or zip code drastically lowers the speed and accuracy of the batch geocoder.</p>
</div>
<div class="section level3">
<h3 id="batch-geocoding">Batch Geocoding<a class="anchor" aria-label="anchor" href="#batch-geocoding"></a>
</h3>
<p>In this example, we will use the included <code>stl_homicides_small</code> data, which we loaded above and assigned to the object <code>df</code>, show the full process for batch geocoding with <code><a href="../reference/cxy_geocode.html">cxy_geocode()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cxy_geocode.html">cxy_geocode</a></span><span class="op">(</span><span class="va">df</span>, address <span class="op">=</span> <span class="st">"street_address"</span>, 
                     city <span class="op">=</span> <span class="st">"city"</span>, 
                     state <span class="op">=</span> <span class="st">"state"</span>, 
                     zip <span class="op">=</span> <span class="st">"postal_code"</span>, 
                     class <span class="op">=</span> <span class="st">"dataframe"</span><span class="op">)</span></code></pre></div>
<p>Since we have selected <code>"dataframe"</code> for our <code>class</code>, all input addressed will be returned. If you use <code>class = "sf"</code> (and have <code>sf</code> installed), you will receive only matched addresses.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cxy_geocode.html">cxy_geocode</a></span><span class="op">(</span><span class="va">df</span>, address <span class="op">=</span> <span class="st">"street_address"</span>, 
                     city <span class="op">=</span> <span class="st">"city"</span>, 
                     state <span class="op">=</span> <span class="st">"state"</span>, 
                     zip <span class="op">=</span> <span class="st">"postal_code"</span>, 
                     class <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></code></pre></div>
<p>Though <code>sf</code> objects only returned matched addresses, one advantage of using this <em>optional</em> set of features is that output returned as an <code>sf</code> object can be previewed with a package like <a href="https://cran.r-project.org/package=mapview" class="external-link"><code>mapview</code></a>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mapview</span><span class="fu">::</span><span class="fu">mapview</span><span class="op">(</span><span class="va">df_sf</span><span class="op">)</span></code></pre></div>
<p><img src="../reference/figures/homicide_example.png" width="100%"></p>
<p>Note that, like <code>sf</code> and the parallel processing dependencies, <code>mapview</code> is a suggested package and must be installed separately (or by using <code>install.packages("censusxy", dependencies = TRUE)</code>).</p>
</div>
<div class="section level3">
<h3 id="single-address-tools">Single Address Tools<a class="anchor" aria-label="anchor" href="#single-address-tools"></a>
</h3>
<p>If you have individual addresses you would like to geocode, there are two additional functions to be aware. <code><a href="../reference/cxy_single.html">cxy_single()</a></code> can geocode a single address that has already been parsed into separate entries for <code>street</code>, <code>city</code>, <code>state</code>, and <code>zip</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cxy_single.html">cxy_single</a></span><span class="op">(</span>street <span class="op">=</span> <span class="st">"20 N Grand Blvd"</span>, city <span class="op">=</span> <span class="st">"St. Louis"</span>, state <span class="op">=</span> <span class="st">"MO"</span>, zip <span class="op">=</span> <span class="fl">63103</span><span class="op">)</span></code></pre></div>
<p>Alternatively, you can pass un-parsed addresses using <code><a href="../reference/cxy_oneline.html">cxy_oneline()</a></code>. This example returns Census geography data along with the default location information:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cxy_oneline.html">cxy_oneline</a></span><span class="op">(</span>address <span class="op">=</span> <span class="st">"3700 Lindell Blvd, St. Louis, MO 63108"</span>, return <span class="op">=</span> <span class="st">"geographies"</span>, vintage <span class="op">=</span> <span class="st">"Current_Current"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="coordinate-pairs">Coordinate Pairs<a class="anchor" aria-label="anchor" href="#coordinate-pairs"></a>
</h3>
<p>Finally, if you know pairs of coordinates but would like to find out what Census geographies they fall within, you can use <code><a href="../reference/cxy_geography.html">cxy_geography()</a></code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cxy_geography.html">cxy_geography</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="op">-</span><span class="fl">90.23324</span>, lat <span class="op">=</span> <span class="fl">38.63593</span><span class="op">)</span></code></pre></div>
<p>This function is useful for a small number of addresses, but returns a <em>significant</em> amount of data for each point location. If you have a large number of points and need a specific value like county or congressional district, using <code>tigris</code> to obtain those data and then <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">sf::st_intersection()</a></code> to perform a spatial join will be a more effective solution that performs this task faster and results in clearer output.</p>
</div>
<div class="section level3">
<h3 id="iteration">Iteration<a class="anchor" aria-label="anchor" href="#iteration"></a>
</h3>
<p>For a handful of addresses, you may want to iterate using these functions. Two examples using base R are provided here:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">addresses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"20 N Grand Blvd, St. Louis MO 63103"</span>, <span class="st">"3700 Lindell Blvd, St. Louis, MO 63108"</span><span class="op">)</span>

<span class="co"># with a loop</span>
<span class="va">geocodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">addresses</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">geocodes</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cxy_oneline.html">cxy_oneline</a></span><span class="op">(</span><span class="va">addresses</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># with apply</span>
<span class="va">geocodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">addresses</span>, <span class="va">cxy_oneline</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<ul>
<li>If you are new to <code>R</code> itself, welcome! Hadley Wickham’s <a href="https://r4ds.had.co.nz" class="external-link"><em>R for Data Science</em></a> is an excellent way to get started with data manipulation in the tidyverse, which <code>censusxy</code> is designed to integrate seamlessly with.</li>
<li>If you are new to spatial analysis in <code>R</code>, we strongly encourage you check out the excellent new <a href="https://geocompr.robinlovelace.net" class="external-link"><em>Geocomputation in R</em></a> by Robin Lovelace, Jakub Nowosad, and Jannes Muenchow.</li>
<li>If you have questions about using <code>censusxy</code>, you are encouraged to use the <a href="https://community.rstudio.com" class="external-link">RStudio Community forums</a>. Please create a <a href="https://reprex.tidyverse.org/" class="external-link"><code>reprex</code></a> before posting. Feel free to tag Chris (<code>@chris.prener</code>) in any posts about <code>censusxy</code>.</li>
<li>If you think you’ve found a bug, please create a <a href="https://reprex.tidyverse.org/index.html" class="external-link"><code>reprex</code></a> and then open an issue on <a href="https://github.com/slu-openGIS/censusxy/issues/new/choose" class="external-link">GitHub</a>.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://chris-prener.github.io" class="external-link">Christopher Prener</a>, <a href="https://bransonf.com" class="external-link">Branson Fox</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
